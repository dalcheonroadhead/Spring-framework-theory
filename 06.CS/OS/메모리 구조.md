# 1. 운영체제에서의 메모리 구조란?

**`RAM(주 기억 장치)`**이란 물리적 메모리를 논리적(가상)으로 영역을 지어 나눈 것.

## (1) 하드웨어에서의 메모리 구조

```Scss
하드웨어 메모리 계층 구조
├── 레지스터
│   └─ CPU 내부에 위치 (가장 빠른 메모리)
├── 캐시 (L1, L2, L3)
│   └─ CPU와 RAM 사이에서 자주 사용되는 데이터를 저장
├── 주기억장치 (RAM)
│   ├── 사용자 영역 (User Space)
│   │   
│   │   
│   │   
│   │   
│   └── 커널 영역 (Kernel Space)
│       
│       
│       
│       
└── 보조기억장치 (HDD, SSD)
    ├── 스왑 공간 (Swap Space)
    └── 영구 데이터 저장소
```

저장소라는 메모리의 본 뜻에 맞게 하드웨어적인 메모리를 구분 지어 살펴보면 위와 같이 나온다. 

여기서 우리가 주효하게 사용하는 RAM을 효율적으로 사용하기 위해 **RAM 안의 영역을 논리적으로(==가상으로) 구분 짓는다. ** 이것이 운영체제에서 말하는 메모리 구조이다. 

RAM 영역을 운영체제의 논리에 맞게 다시 구분 지어보면,

## (2) 운영체제의 메모리 구조

```scss
   ├── 사용자 영역 (User Space)
   │   ├── 텍스트 영역
   │   ├── 데이터 영역
   │   ├── 힙 영역
   │   └── 스택 영역
   └── 커널 영역 (Kernel Space)
       ├── 커널 코드
       ├── 커널 데이터
       ├── 커널 힙
       └── 커널 스택
```

다음과 같이 나뉜다.

**`사용자 영역`**은 운영체제의 사용자를 위한 영역이고, **`커널 영역`**은 운영체제 자체도 하나의 프로그램이라 그것을 실행하기 위해 활용되는 영역이다. 이제 세세히 알아보겠다.

# 2. 사용자 영역 설명

## (1) 코드 영역

### `정의` 

사용자가 실행한 프로그램의 코드가 저장되는 영역

### `특징`

- 1️⃣ `기계어`: 사용자가 실행한 프로그램의 기계어 코드가 저장됨
- 2️⃣ `모두 각자의 집`: 모든 프로세스(프로그램이 살아있을 때 이름)은 자신만의 독립된 영역을 가짐
- 3️⃣ `읽기 전용`: 실행 중 수정 불가
- 4️⃣ `공유 영역의 존재`: 동일한 프로그램의 여러 인스턴스 혹은 프로세스가 같은 코드 영역을 공유 가능
- 5️⃣ `정적인 크기`: 코드 영역의 크기는 프로그램 실행 시 결정되며 도중에 변경 되지 않음. 
- 6️⃣ `운영 체제에 의해 보호됨`

## (2) 데이터 영역

### `정의`

**전역변수**와 **정적 변수**를 저장하고 그것들의 **상태유지**를 담당한다.

- `전역 변수`: 모든 함수에서 접근 가능한 변수, 따라서 프로그램 전체에서 공유됨
- `정적 변수`: 함수 내에서 선언되더라도 프로그램 종료 시까지 메모리에 유지됨
- `상태유지`: 전역 혹은 정적 변수의 값이 도중에 바뀌면 그 상태를 유지시킴

### `특징`

- 1️⃣  `프로그램 실행 시 초기화`: 프로그램이 실행될 때 메모리에 할당됨,
- 2️⃣ `데이터 구분 관리`: 초기화된 데이터와 초기화되지 않은 데이터를 나누어 저장
- 3️⃣ `읽기 및 쓰기 가능`: 프로그램 실행 중에도 변수의 값 변경이 가능 
- 4️⃣ `정적 크기`: 프로그램 실행 과정에서 크기가 결정되며 변경되지 않음
- 5️⃣ `데이터 영역은 프로세스 별 독립적`

## (3) 힙 영역

### `정의`

**런타임 시점에서 메모리가 필요할 때**, 프로그래머가 직접 코드를 써서 메모리를 사용하고, 해제할 수 있도록 비워둔 영역 

### `특징`

- 1️⃣ `사용자가 직접 메모리 관리`: 사용자가 직접 할당해서 쓰고 직접 해제하며 관리 해야함. (안하면 메모리 누수 위험)
- 2️⃣`누구나 접근`: 프로세스 별로 독립적으로 영역 구분되지만 같은 프로세스 내 Thread들이 사용하는 Heap 영역은 하나로 공유됨.
- 3️⃣ `메모리 접근`: 스택보다 느림
- 4️⃣ `크기 제한 없음`: 스택이랑 총 파이를 공유 
- 5️⃣  `성장`: 위에서 아래로 성장

## (4) 스택 영역

### `정의`

텍스트 영역에서 코드를 실행하며 함수가 호출될 때, **해당 함수에 필요한 데이터**를 관리함.
(ex - 함수의 지역 변수, 매개변수, 리턴 주소 등)

함수 실행이 끝나면 관련 데이터를 자동으로 제거해서 효율적으로 메모리를 관리함.

### `특징`

- 1️⃣ `자동 메모리 관리`: 함수 호출 시 자동으로 메모리 할당 되고 함수 종료 시 자동으로 해제
- 2️⃣ `변수에 대한 지역적 접근`: 함수 내에서만 접근 가능
- 3️⃣ `메모리 접근`: LIFO 구조로 간단히 관리 되어서 힙보다 빠름
- 4️⃣ `메모리 크기가 제한됨`: 크기가 고정적, (넘으면 스택 오버 플로우 에러 발생)
- 5️⃣  `성장`: 아래에서 위로 (높은 주소에서 낮은 주소로) 메모리 영역이 확장됨.